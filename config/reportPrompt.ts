import { Entry, Category } from "../types";

/**
 * –ü–µ—Ä–µ–≤–æ–¥—ã –ø–µ—Ä–∏–æ–¥–æ–≤ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
 */
const PERIOD_TRANSLATION: Record<string, string> = {
  'Day': '–¥–Ω–µ–≤–Ω–æ–π',
  'Week': '–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π',
  'Month': '–µ–∂–µ–º–µ—Å—è—á–Ω—ã–π'
};

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ –ø—Ä–æ–º–ø—Ç
 */
const formatEntries = (entries: Entry[], categories: Category[]): string => {
  return entries.map(e => {
    const cat = categories.find(c => c.id === e.categoryId);
    return `[${new Date(e.createdAt).toLocaleTimeString('ru-RU')}][–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${cat?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}] ${e.text}`;
  }).join('\n');
};

/**
 * –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ AI –æ—Ç—á–µ—Ç–∞
 * 
 * @param entries - –ó–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
 * @param categories - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
 * @param period - –ü–µ—Ä–∏–æ–¥ –æ—Ç—á–µ—Ç–∞ ('Day', 'Week', 'Month')
 * @returns –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ AI
 */
export const buildReportPrompt = (
  entries: Entry[],
  categories: Category[],
  period: string
): string => {
  const entriesFormatted = formatEntries(entries, categories);
  const periodLabel = PERIOD_TRANSLATION[period] || '–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π';

  const prompt = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∏–∂–µ –∑–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ –∏ —Å–æ—Å—Ç–∞–≤—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ${periodLabel} –æ—Ç—á–µ—Ç –æ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.

–í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:
${entriesFormatted}

–ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –§–û–†–ú–ê–¢–£:
–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown. –ù–µ –ø–∏—à–∏ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π –≤—Ä–æ–¥–µ "–í–æ—Ç –≤–∞—à –æ—Ç—á–µ—Ç", –Ω–∞—á–∏–Ω–∞–π —Å—Ä–∞–∑—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞.

**–ü–†–ê–í–ò–õ–ê –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø MARKDOWN (–ö–†–ò–¢–ò–ß–ù–û):**
1. –ó–∞–≥–æ–ª–æ–≤–∫–∏: –∏—Å–ø–æ–ª—å–∑—É–π ## –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ä–∞–∑–¥–µ–ª–æ–≤
2. –°–ø–∏—Å–∫–∏: –∏—Å–ø–æ–ª—å–∑—É–π –º–∞—Ä–∫–µ—Ä—ã (-) –¥–ª—è –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤, –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –∑–≤–µ–∑–¥–æ—á–∫–∏ (*) –∫–∞–∫ –º–∞—Ä–∫–µ—Ä—ã
3. –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏: –¥–µ–ª–∞–π —á–µ—Ä–µ–∑ –æ—Ç—Å—Ç—É–ø—ã (–¥–≤–∞ –ø—Ä–æ–±–µ–ª–∞ –ø–µ—Ä–µ–¥ –º–∞—Ä–∫–µ—Ä–æ–º), –Ω–∞–ø—Ä–∏–º–µ—Ä:
   - –û—Å–Ω–æ–≤–Ω–æ–π –ø—É–Ω–∫—Ç
     - –í–ª–æ–∂–µ–Ω–Ω—ã–π –ø—É–Ω–∫—Ç
4. –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞: 
   - **–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç** –¥–ª—è –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤
   - _–∫—É—Ä—Å–∏–≤_ –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ —Ü–∏—Ç–∞—Ç
   - –ù–ï –∫–æ–º–±–∏–Ω–∏—Ä—É–π –º–∞—Ä–∫–µ—Ä—ã —Å–ø–∏—Å–∫–∞ (-) —Å–æ –∑–≤–µ–∑–¥–æ—á–∫–∞–º–∏ (*) - —ç—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –æ—à–∏–±–∫—É
5. –ü—Ä–∏–º–µ—Ä—ã –≤ —Ç–µ–∫—Å—Ç–µ: –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ –∫—É—Ä—Å–∏–≤ (_–ø—Ä–∏–º–µ—Ä_), –Ω–æ –ù–ï –¥–µ–ª–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ø–∏—Å–∫–∏ —Å–æ –∑–≤–µ–∑–¥–æ—á–∫–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞

–°–¢–†–£–ö–¢–£–†–ê –û–¢–ß–ï–¢–ê:

## 1. üî≠ –ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä
–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –æ —Ç–æ–º, –∫–∞–∫ –ø—Ä–æ—à–µ–ª —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥.
- –ö–∞–∫–∏–µ —Å—Ñ–µ—Ä—ã –∂–∏–∑–Ω–∏ (—Ä–∞–±–æ—Ç–∞, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∑–¥–æ—Ä–æ–≤—å–µ) –¥–æ–º–∏–Ω–∏—Ä–æ–≤–∞–ª–∏?
- –ì–ª–∞–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏–ª–∏ –º—ã—Å–ª—å –ø–µ—Ä–∏–æ–¥–∞.

## 2. üìâ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞
–ù–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—á–∏—Å–ª–∏ —ç–º–æ—Ü–∏–∏, –∞ –æ–ø–∏—à–∏ –∏—Ö –¥–≤–∏–∂–µ–Ω–∏–µ.
- –ö–∞–∫ –º–µ–Ω—è–ª–æ—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ? (–ù–∞–ø—Ä–∏–º–µ—Ä: "–æ—Ç —Ç—Ä–µ–≤–æ–≥–∏ –∫ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—é" –∏–ª–∏ "—Å—Ç–∞–±–∏–ª—å–Ω–æ –≤—ã—Å–æ–∫–∏–π —Ñ–æ–Ω").
- –ß—Ç–æ —è–≤–ª—è–ª–æ—Å—å –æ—Å–Ω–æ–≤–Ω—ã–º –¥—Ä–∞–π–≤–µ—Ä–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è?

## 3. üß© –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –ò–Ω—Å–∞–π—Ç—ã
–°–∞–º–∞—è –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å. –°–≤—è–∂–∏ —Å–æ–±—ã—Ç–∏—è –∏ —Ä–µ–∞–∫—Ü–∏–∏.
- –ù–∞–π–¥–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—Ç—Ä–∏–≥–≥–µ—Ä -> —Ä–µ–∞–∫—Ü–∏—è).
- –£–∫–∞–∂–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å.
- **–í–ê–ñ–ù–û:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–π —Å–≤–æ–∏ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Ü–∏—Ç–∞—Ç–∞–º–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: _"–ö–∞–∫ —Ç—ã –∑–∞–º–µ—Ç–∏–ª –≤–æ –≤—Ç–æ—Ä–Ω–∏–∫..."_).

**–ö–∞–∫ –æ–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã:**
–ò—Å–ø–æ–ª—å–∑—É–π –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- –ü–∞—Ç—Ç–µ—Ä–Ω "–†–∞–¥–∏–∫–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è": —Ç—ã –±—ã—Å—Ç—Ä–æ –∏–∑–±–∞–≤–ª—è–µ—à—å—Å—è –æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç –ø–æ–∂–∏—Ä–∞—Ç—å –≤—Ä–µ–º—è. _–ü—Ä–∏–º–µ—Ä:_ —Å–∏—Ç—É–∞—Ü–∏—è —Å –ø—Ä–æ–≥—Ä–∞–º–º–æ–π Caramba, –∫–æ—Ç–æ—Ä—É—é —Ç—ã —É–¥–∞–ª–∏–ª –∏–∑-–∑–∞ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏—è.

## 4. üí° –§–æ–∫—É—Å –Ω–∞ –±—É–¥—É—â–µ–µ
- **–ú–∏–∫—Ä–æ-—à–∞–≥:** –û–¥–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É–∂–µ –∑–∞–≤—Ç—Ä–∞ (–Ω–µ –æ–±—â–∏–µ —Å–ª–æ–≤–∞, –∞ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞).
- **–í–æ–ø—Ä–æ—Å –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è:** –û–¥–∏–Ω –≥–ª—É–±–æ–∫–∏–π –∫–æ—É—á–∏–Ω–≥–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–µ—Ä–∏–æ–¥–µ.`;

  return prompt;
};


